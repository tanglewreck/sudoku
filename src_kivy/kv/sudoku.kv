#:kivy 2.0.3

#:import random random
#:import string string
#:import sudoku sudoku



<BoardButton>:
    canvas.before:
        Color:
            rgba: 255/255, 255/255, 255/255, 100/100
        Rectangle:
            pos: self.pos
            size: self.size
    background_color: 220/255, 220/255, 0/255, 30/100
    bold: True
    font_size: '24sp'
    markup: True
    # 
    # Set the text to the activate number (chosen on the numpad):
    #
    # This is butt ugly! Gotta find a cleaner, neater, better way of
    # updating the blockbutton text!
    #
    #                       <SudokuBlock>
    #                            |      <GridLayout>
    #                            |      |      <RootWidget>
    #                            |      |      |      <BoxLayout>
    #                            |      |      |      |           <AnchorLayout>
    #                            |      |      |      |           |           <Label>
    #                            |      |      |      |           |           |
    #                            |      |      |      |           |           |
    on_release: self.text = self.parent.parent.parent.children[0].children[2].children[0].text # the text property of the Label widget (i.e. active_number)
    # on_release: self.update_block_button(self.text)


# <BoardButtonTest>:
#     canvas.before:
#         Color:
#             rgba: 55/255, 255/255, 255/255, 0/100
#         Rectangle:
#             pos: self.pos
#             size: self.size
#     padding: 0
#     background_color: 0/255, 220/255, 0/255, 40/100
#     font_size: '24sp'
#     bold: True
#     on_release: root.update_block_button(self.text)


<NumberPadButton>:
    canvas.before:
        Color:
            rgba: 255/255, 255/255, 255/255, 100/100
    canvas:
        Line:
            rectangle: self.x, self.y, self.width, self.height
            width: 1
        #Color:
        #    rgba: 255/255, 255/255, 255/255, 100/100
        # Rectangle:
        #     pos: self.pos
        #     size: self.size
        #     pos: self.x + 2, self.y - 4
        #     size: self.width * 1.025, self.height * 1.05
    background_color: 220/255, 220/255, 0/255, 5/100
    # background_normal: ''
    background_normal: "atlas://data/images/defaulttheme/button"
    background_disabled_normal: "atlas://data/images/defaulttheme/button"
    # background_disabled_normal: "atlas://data/images/defaulttheme/button_disabled"
    # border: 25, 25, 25, 25 # defaults to (16, 16, 16, 16)
    # opacity: 100/100
    font_size: '16sp'
    markup: True
    bold: True

    # Set the text of the status label (UGLY and very prone to stop working if
    # the layouts change...):
    on_press: self.parent.parent.children[2].children[0].text = f"[color=fffff0][size=48]{self.text}[/size][/color]" if self.text in ['1','2','3','4','5','6','7','8','9'] else ""  # After adding AnchorLayouts to the right hand side

    # on_press: self.parent.parent.children[1].text = f"[color=fffff0][size=48]{self.text}[/size][/color]" if self.text in ['1','2','3','4','5','6','7','8','9'] else ""

    # on_press: self.parent.parent.children[1].text = f"[color=fffff0][size=48]{self.text}[/size][/color]" if not self.text == "X" else ""
    # on_press: self.parent.parent.children[1].text = self.text if not self.text == "X" else ""


<SudokuBlock>: # inherits GridLayout
    canvas:
        Color:
            rgba: 0/255, 0/255, 0/255, 10/100
        Line:
            width: 4
            rectangle: self.x, self.y, self.width, self.height
    cols: 3
    rows: 3
    # background_color: 220/255, 220/255, 0/255, 100/100
    opacity: 0.85
    padding: 0
    spacing: 0


<SudokuBlockLight>: # Inherits SudokuBlock
    opacity: 0.65

    
<RootWidget>:
    thenumber: active_number
    # s11x: s11
    id: main_window
    canvas:
        Color:
            # rgba: 85.5/255, 85.5/255, 45.5/255, 1  # yellowish
            # rgba: 200/255, 200/255, 200/255, 70/100  # lightgrey
            rgba: 255/255, 255/255, 225/255, 80/100
        Rectangle:
            pos: self.pos
            size: self.size
    orientation: 'horizontal'
    opacity: 1.0
    spacing: 20
    padding: '70sp', '50sp', '70sp', '50sp'
    # padding: Padding between layout box and children: [padding_left, padding_top, padding_right, padding_bottom].
    # padding: (50, 50, 50, 50)
    # pos_hint: {'center_x': 0.45, 'center_y': 0.8}
    # size_hint: (None, None)
    # size_hint_y: None

    # Sudoku board (9x9)
    GridLayout:
        canvas:
            Color:
                rgba: 0/255, 0/255, 0/255, 20/100  # lightgrey
            Rectangle: # draws a rectangle around individual squares
                size: self.size
                pos: self.pos
            Line: # draws a rectangle around the GridLayout as a whole
                width: 8
                rectangle: self.x, self.y, self.width, self.height
        cols: 3
        rows: 3
        padding: '1sp'
        spacing: '2sp'
        size_hint_x: 3/8
        
        # Block 1,1
        SudokuBlock:
            BoardButton:
                id: s11
                # on_press: self.text = active_number.text
            BoardButton:
                id: s12
                # on_press: self.text = active_number.text
            BoardButton:
                id: s13
            BoardButton:
                id: s14
            BoardButton:
                id: s15
            BoardButton:
                id: s16
            BoardButton:
                id: s17
            BoardButton:
                id: s18
            BoardButton:
                id: s19
        # Block 1,2
        SudokuBlockLight:
            BoardButton:
                id: s21
            BoardButton:
                id: s22
            BoardButton:
                id: s23
            BoardButton:
                id: s24
            BoardButton:
                id: s25
            BoardButton:
                id: s26
            BoardButton:
                id: s27
            BoardButton:
                id: s28
            BoardButton:
                id: s29
        # Block 1,3
        SudokuBlock:
            BoardButton:
                id: s31
            BoardButton:
                id: s32
            BoardButton:
                id: s33
            BoardButton:
                id: s34
            BoardButton:
                id: s35
            BoardButton:
                id: s36
            BoardButton:
                id: s37
            BoardButton:
                id: s38
            BoardButton:
                id: s39
        
        # Block 2,1
        SudokuBlockLight:
            BoardButton:
                id: s41
            BoardButton:
                id: s42
            BoardButton:
                id: s43
            BoardButton:
                id: s44
            BoardButton:
                id: s45
            BoardButton:
                id: s46
            BoardButton:
                id: s47
            BoardButton:
                id: s48
            BoardButton:
                id: s49
        
        # Block 2,2
        SudokuBlock:
            BoardButton:
                id: s51
            BoardButton:
                id: s52
            BoardButton:
                id: s53
            BoardButton:
                id: s54
            BoardButton:
                id: s55
            BoardButton:
                id: s56
            BoardButton:
                id: s57
            BoardButton:
                id: s58
            BoardButton:
                id: s59
            
        # Block 2,3
        SudokuBlockLight:
            BoardButton:
                id: s61
            BoardButton:
                id: s62
            BoardButton:
                id: s63
            BoardButton:
                id: s64
            BoardButton:
                id: s65
            BoardButton:
                id: s66
            BoardButton:
                id: s67
            BoardButton:
                id: s68
            BoardButton:
                id: s69
            
        # Block 3,1
        SudokuBlock:
            BoardButton:
                id: s71
            BoardButton:
                id: s72
            BoardButton:
                id: s73
            BoardButton:
                id: s74
            BoardButton:
                id: s75
            BoardButton:
                id: s76
            BoardButton:
                id: s77
            BoardButton:
                id: s78
            BoardButton:
                id: s79
        
        # Block 3,2
        SudokuBlockLight:
            BoardButton:
                id: s81
            BoardButton:
                id: s82
            BoardButton:
                id: s83
            BoardButton:
                id: s84
            BoardButton:
                id: s85
            BoardButton:
                id: s86
            BoardButton:
                id: s87
            BoardButton:
                id: s88
            BoardButton:
                id: s89
        
        # Block 3,3
        SudokuBlock:
            BoardButton:
                id: s91
            BoardButton:
                id: s92
            BoardButton:
                id: s93
            BoardButton:
                id: s94
            BoardButton:
                id: s95
            BoardButton:
                id: s96
            BoardButton:
                id: s97
            BoardButton:
                id: s98
            BoardButton:
                id: s99


    # = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = 
    #  Right-hand side panel, stacked vertically. Includes numberpad, status
    #  label, and quit-button
    # = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = 
    BoxLayout:
        orientation: 'vertical'
        size_hint: 0.25, 1 # 1/4 of root widget width, 1/1 of root widget height
        padding: 50, 200, 0, 0
        # padding: 0
        align: 'center'
        valign: 'bottom'

        # = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
        # Numpad: A 3x4 grid (last row containing two placeholder   #
        #         buttons (disabled) surrounding the 'X' button     #
        # = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
        GridLayout:
            canvas.before:
                Color:
                    rgba: 0, 0, 0, 1/4
                Line: # draws a rectangle around the GridLayout as a whole
                    width: 4
                    rectangle: self.x, self.y, self.width, self.height
            canvas:
                Color:
                    rgba: 255/255, 255/255, 255/255, 80/100  
                Line: # draws a rectangle around the GridLayout as a whole
                    width: 2
                    rectangle: self.x, self.y, self.width, self.height
                #Rectangle: # draws a rectangle around individual squares
                #    size: self.size
                #    pos: self.pos
            cols: 3
            rows: 4
            size_hint: 1, 0.5
            spacing: '1sp'
    
            NumberPadButton:
                id: b1
                text: "1"
                # on_press: active_number.text = "1"
            NumberPadButton:
                id: b2
                text: "2"
            NumberPadButton:
                id: b3
                text: "3"
            NumberPadButton:
                id: b4
                text: "4"
            NumberPadButton:
                id: b5
                text: "5"
            NumberPadButton:
                id: b6
                text: "6"
            NumberPadButton:
                id: b7
                text: "7"
            NumberPadButton:
                id: b8
                text: "8"
            NumberPadButton:
                id: b9
                text: "9"
            NumberPadButton: # placeholder
                text: "[size=14]Note[/size]"
            #    disabled: True
            NumberPadButton:
                id:bx
                text: "X"
                on_press: active_number.text = ""
            NumberPadButton: # placeholder
                text: "[size=24][/size]"
                disabled: True
    
        #
        # Label showing which number has been selected, or "" (blank) if the 'X' button has been pressed)
        #
        AnchorLayout:
            anchor_x: 'center'
            anchor_y: 'center'
            size_hint_y: 0.5
            Label:
                id: active_number
                font_size: '18sp'
                bold: True
                markup: True
                padding: 0, 0, 0, 0
                #size_hint_y: 0.15
                # on_ref_press: self.text = "fubar" # active_number.text
                # text: "[ref=foo]0[/ref]"
                # text: "[ref=footext][color=aabbaa]Label[/color][color=ff3333][sub]with[/sub][/color][color=3333ff][b]mark[sup]up[/sup][/b][/color][/ref]"

        #
        # Load button
        #
        AnchorLayout:
            # cols: 1
            # rows: 1
            size_hint_y: 0.15
            size_hint_x: 1
            anchor_x: 'center'
            anchor_y: 'bottom'
            Button:
                canvas:
                    Color: 
                        rgba: 0/255, 0/255, 10/255, 20/100
                    Line:
                        width: 2
                        rectangle: self.x, self.y, self.width, self.height
                background_color: 255/255, 255/255, 0/255, 20/100
                opacity: 80/100
                # padding: 10,10,10,10
                padding: 0
                # pos_hint: {'center_x': 100}
                size_hint: 0.5, None
                height: '30sp'
                markup: True
                bold: False
                text: "Load game from file"
                # on_release: raise SystemExit(0)

        #
        # Quit button
        #
        AnchorLayout:
            # cols: 1
            # rows: 1
            size_hint_y: 0.25
            # size_hint_x: 0.5
            anchor_x: 'right'
            anchor_y: 'bottom'
            GridLayout:
                # orientation: 'vertical' 
                rows: 1
                cols: 2
                valign: 'center'        # ?????
                # size_hint: 1, 0.05      # ?????
                padding: 50
                spacing: 20
                Button:
                    text: 'f00'
                    size_hint: 0.5, None
                    height: '30sp'
                Button:
                    canvas:
                        Color: 
                            rgba: 0/255, 0/255, 10/255, 20/100
                        Line:
                            width: 2
                            rectangle: self.x, self.y, self.width, self.height
                    background_color: 255/255, 255/255, 0/255, 30/100
                    opacity: 80/100
                    # padding: 10,10,10,10
                    padding: 0
                    # pos_hint: {'center_x': 100}
                    size_hint: 0.5, None
                    height: '30sp'
                    markup: True
                    bold: False
                    text: "[color=ff4040]Q[/color][sup][size=24][color=2040aa]u[/color][/size][/sup][sub][size=32][color=602010]i[/color][/size][/sub][i][sup][size=36][color=ffff00]t[/color][/size][/i]"
                    on_release: raise SystemExit(0)
    

<CustomLabel>:
    canvas.after:
        Color:
            rgba: 51/255, 51/255, 51/255, 25/100
        Rectangle:
            pos: self.pos
            size: self.size
    padding: 20
    halign: 'right'
    font_size: '14sp'
    bold: False
    markup: True
    # on_ref_press: sudoku.RootWidget.update_label_text(self, 's11', "10") 
    # on_ref_press: self.text = root.active_number.text
